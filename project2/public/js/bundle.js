(()=>{"use strict";var e=function(){return fetch("/api/v1/users").then((function(e){if(!e.ok)throw new Error("Unauthorized");return e.json()}))},n=document.querySelector(".login-form"),t=document.querySelector(".message-form"),r=document.querySelector(".list-messages"),o=document.querySelector(".list-users"),i=document.querySelector(".logout-button"),c=document.querySelector(".loading-indicator"),a=(document.querySelector(".error-message"),function(e){var n=document.querySelector(".error-message");n.textContent=e,n.classList.remove("hidden"),clearTimeout(n.hideTimeout),n.hideTimeout=setTimeout((function(){n.classList.add("hidden")}),5e3)}),s=function(e){e?c.classList.remove("hidden"):c.classList.add("hidden")},u=function(){s(!0),e().then((function(){document.querySelector(".container-login").classList.add("hidden"),document.querySelector(".container-chat").classList.remove("hidden"),f().then((function(){return d()})).then((function(){return l()}))})).catch((function(e){"Unauthorized"===e.message?(document.querySelector(".container-login").classList.remove("hidden"),document.querySelector(".container-chat").classList.add("hidden")):a("An unexpected error occurred. Please try again.")})).finally((function(){return s(!1)}))};n.addEventListener("submit",(function(e){var n;e.preventDefault(),s(!0),(n=e.target.elements.username.value,fetch("/api/v1/users/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:n})}).then((function(e){if(!e.ok)throw new Error("".concat(e.status," ").concat(e.statusText));return e.json()}))).then(u).catch((function(e){e.response&&400===e.response.status?a("Invalid request. Please check your input and try again."):a("Login failed. Please try again.")})).finally((function(){return s(!1)}))}));var l=function(){setInterval((function(){Promise.all([d(),f()]).catch((function(e){console.error("Polling error:",e),"Unauthorized"===e.message?a("Session expired. Please log in again."):a("An error occurred. Please try again.")}))}),5e3)};i.addEventListener("click",(function(){s(!0),fetch("/api/v1/users/session",{method:"DELETE"}).then((function(e){if(!e.ok)throw new Error("Logout failed");return 204===e.status?Promise.resolve():e.json()})).catch((function(e){throw console.error("Error during logout:",e),e})).then((function(){document.querySelector(".container-login").classList.remove("hidden"),document.querySelector(".container-chat").classList.add("hidden")})).catch((function(){return a("Logout failed. Please try again.")})).finally((function(){return s(!1)}))})),t.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.elements.message.value.trim();n?(s(!0),function(e){return fetch("/api/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})}).then((function(e){return e.ok?e.json():e.json().then((function(n){throw new Error("".concat(e.status,": ").concat(n.error))}))})).catch((function(e){throw console.error("Error posting message:",e),e}))}(n).then((function(){e.target.elements.message.value="",d()})).catch((function(e){e.message&&e.message.includes("400")?a("Message content cannot be empty."):a("Failed to send message. Please try again.")})).finally((function(){return s(!1)}))):a("Message cannot be empty.")}));var d=function(){return s(!0),fetch("/api/v1/messages").then((function(e){if(!e.ok)throw new Error("".concat(e.status," ").concat(e.statusText));return e.json()})).then((function(e){r.innerHTML=e.map((function(e){return"<div>".concat(e.username,": ").concat(e.content,"</div>")})).join("")})).catch((function(){return a("Failed to load messages. Please try again.")})).finally((function(){return s(!1)}))},f=function(){return s(!0),e().then((function(e){o.innerHTML=e.map((function(e){return"<li>".concat(e,"</li>")})).join("")})).catch((function(){return a("Failed to load users. Please try again.")})).finally((function(){return s(!1)}))};u()})();